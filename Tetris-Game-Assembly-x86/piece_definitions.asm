PIECE_DEFINITIONS_ASM EQU 1
INCLUDE globals.inc

PUBLIC pieceArray
PUBLIC getRandomPiece

;Pieces are defined in such order(Might change later):
;	0 0 1 0 0	0 0 0 0 0
;	0 0 1 0 0	0 0 0 0 0
;	0 0 1 0 0	1 1 1 1 0
;	0 0 1 0 0	0 0 0 0 0
;	0 0 0 0 0	0 0 0 0 0

;	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0
;	0 2 0 0 0	0 0 2 2 0	0 2 2 2 0	0 0 2 0 0
;	0 2 2 2 0	0 0 2 0 0	0 0 0 2 0	0 0 2 0 0
;	0 0 0 0 0	0 0 2 0 0	0 0 0 0 0	0 2 2 0 0
;	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0

;	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0
;	0 0 0 3 0	0 0 3 0 0	0 3 3 3 0	0 3 3 0 0
;	0 3 3 3 0	0 0 3 0 0	0 3 0 0 0	0 0 3 0 0
;	0 0 0 0 0	0 0 3 3 0	0 0 0 0 0	0 0 3 0 0
;	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0

;	0 0 0 0 0
;	0 0 0 0 0
;	0 4 4 0 0
;	0 4 4 0 0
;	0 0 0 0 0

;	0 0 0 0 0	0 0 0 0 0
;	0 0 5 5 0	0 5 0 0 0
;	0 5 5 0 0	0 5 5 0 0
;	0 0 0 0 0	0 0 5 0 0
;	0 0 0 0 0	0 0 0 0 0

;	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0
;	0 0 6 0 0	0 0 6 0 0	0 6 6 6 0	0 0 6 0 0
;	0 6 6 6 0	0 0 6 6 0	0 0 6 0 0	0 6 6 0 0
;	0 0 0 0 0	0 0 6 0 0	0 0 0 0 0	0 0 6 0 0
;	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0	0 0 0 0 0

;	0 0 0 0 0	0 0 0 0 0
;	0 7 7 0 0	0 0 7 0 0
;	0 0 7 7 0	0 7 7 0 0
;	0 0 0 0 0	0 7 0 0 0
;	0 0 0 0 0	0 0 0 0 0

.data
    pieceArray  BYTE 0,0,1,0,0, 0,0,1,0,0, 0,0,1,0,0, 0,0,1,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,0,0,0,0, 1,1,1,1,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,0,1,0,0, 0,0,1,0,0, 0,0,1,0,0, 0,0,1,0,0
                BYTE 0,0,0,0,0, 0,0,0,0,0, 1,1,1,1,0, 0,0,0,0,0, 0,0,0,0,0
       
                BYTE 0,0,0,0,0, 0,2,0,0,0, 0,2,2,2,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,2,2,0, 0,0,2,0,0, 0,0,2,0,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,2,2,2,0, 0,0,0,2,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,2,0,0, 0,0,2,0,0, 0,2,2,0,0, 0,0,0,0,0, 0,0,0,0,0
        
                BYTE 0,0,0,0,0, 0,0,0,3,0, 0,3,3,3,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,3,0,0, 0,0,3,0,0, 0,0,3,3,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,3,3,3,0, 0,3,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,3,3,0,0, 0,0,3,0,0, 0,0,3,0,0, 0,0,0,0,0, 0,0,0,0,0
       
                BYTE 0,0,0,0,0, 0,0,0,0,0, 0,4,4,0,0, 0,4,4,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,0,0,0,0, 0,4,4,0,0, 0,4,4,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,0,0,0,0, 0,4,4,0,0, 0,4,4,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,0,0,0,0, 0,4,4,0,0, 0,4,4,0,0, 0,0,0,0,0
       
                BYTE 0,0,0,0,0, 0,0,5,5,0, 0,5,5,0,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,5,0,0,0, 0,5,5,0,0, 0,0,5,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,0,5,5,0, 0,5,5,0,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,5,0,0,0, 0,5,5,0,0, 0,0,5,0,0, 0,0,0,0,0
       
                BYTE 0,0,0,0,0, 0,0,6,0,0, 0,6,6,6,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,6,0,0, 0,0,6,6,0, 0,0,6,0,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,6,6,6,0, 0,0,6,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,6,0,0, 0,6,6,0,0, 0,0,6,0,0, 0,0,0,0,0, 0,0,0,0,0
       
                BYTE 0,0,0,0,0, 0,7,7,0,0, 0,0,7,7,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,0,7,0,0, 0,7,7,0,0, 0,7,0,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,7,7,0,0, 0,0,7,7,0, 0,0,0,0,0, 0,0,0,0,0
                BYTE 0,0,0,0,0, 0,0,7,0,0, 0,7,7,0,0, 0,7,0,0,0, 0,0,0,0,0
.code

; stores index of random piece in esi and rotation index in edi
; NOTE: esi MUST be a multiple of 100 and edi MUST be in range 0-3
getRandomPiece PROC uses eax ebx edx
    call GetMseconds            
    call Randomize               
    mov eax, 7                    
    call RandomRange             
    
    ;multiply by 100 to convert from index to piece array offset
    mov ebx, PIECE_ROTATIONS_SIZE
    mul ebx                       
    mov esi, eax                
    
    ;random rotation index
    mov eax, 4                   
    call RandomRange             
    mov edi, eax               
    
    ret
getRandomPiece ENDP
END